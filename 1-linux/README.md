# 1-linux
## First 6 points
First thing we need is to run an Ubuntu Container
```bash
malina@hoststuff:~/tremend-task$ docker run -it ubuntu
Unable to find image 'ubuntu:latest' locally
latest: Pulling from library/ubuntu
5a7813e071bf: Pull complete 
Digest: sha256:72297848456d5d37d1262630108ab308d3e9ec7ed1c3286a32fe09856619a782
Status: Downloaded newer image for ubuntu:latest
root@d3aaba212739:/# [4286:0321/153338.022102:ERROR:atom_cache.cc(230)] Add chromium/from-privileged to kAtomsToCache
```

- For $1.$, to lookup Public IP of `cloudflare.com`, I tried to see if any tool was installed on the Ubuntu image:
```bash
root@d3aaba212739:/# dig cloudflare.com
bash: dig: command not found
root@d3aaba212739:/# nslookup cloudflare.com
bash: nslookup: command not found
root@d3aaba212739:/# host cloudflare.com
bash: host: command not found
```

Then I decided to install `dnsutils` for `dig` (`apt update && apt install dnsutils`) and we get:
```bash
root@d3aaba212739:/# dig cloudflare.com

; <<>> DiG 9.18.30-0ubuntu0.24.04.2-Ubuntu <<>> cloudflare.com
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 6959
;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
; COOKIE: 31b5ee10c526f22e0100000067dd729a5ab07541fff11485 (good)
;; QUESTION SECTION:
;cloudflare.com.                        IN      A

;; ANSWER SECTION:
cloudflare.com.         26      IN      A       104.16.132.229
cloudflare.com.         26      IN      A       104.16.133.229

;; Query time: 12 msec
;; SERVER: 192.168.100.1#53(192.168.100.1) (UDP)
;; WHEN: Fri Mar 21 14:07:22 UTC 2025
;; MSG SIZE  rcvd: 103
```
We can see 2 public IPs for `cloudflare`: `104.16.132.229` and `104.16.133.229`.

- For $2.$, to map `8.8.8.8` to `google-dns`, first we check `/etc/hosts`, then we append to it the mapping
```bash
root@d3aaba212739:/# cat /etc/hosts 
127.0.0.1       localhost
::1     localhost ip6-localhost ip6-loopback
fe00::  ip6-localnet
ff00::  ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
172.17.0.2      d3aaba212739
root@d3aaba212739:/# echo "8.8.8.8 google-dns" >> /etc/hosts 
root@d3aaba212739:/# cat /etc/hosts 
127.0.0.1       localhost
::1     localhost ip6-localhost ip6-loopback
fe00::  ip6-localnet
ff00::  ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
172.17.0.2      d3aaba212739
8.8.8.8 google-dns
```
Now we can install `ping` to see if the mapping works with `apt install iptuils-ping` and check:
```bash
root@d3aaba212739:/# ping google-dns
PING google-dns (8.8.8.8) 56(84) bytes of data.
64 bytes from google-dns (8.8.8.8): icmp_seq=1 ttl=57 time=28.5 ms
64 bytes from google-dns (8.8.8.8): icmp_seq=2 ttl=57 time=27.4 ms
64 bytes from google-dns (8.8.8.8): icmp_seq=3 ttl=57 time=25.9 ms
64 bytes from google-dns (8.8.8.8): icmp_seq=4 ttl=57 time=25.3 ms
```

- For $3.$ we know `DNS` uses port 53 and we need to check if it is open for `google-dns`.
We install `nmap` with `apt install nmap` and then we do this:
```bash
# for TCP scanning
root@d3aaba212739:/# nmap -p 53 google-dns
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-21 14:05 UTC
Nmap scan report for google-dns (8.8.8.8)
Host is up (0.028s latency).

PORT   STATE SERVICE
53/tcp open  domain

Nmap done: 1 IP address (1 host up) scanned in 0.15 seconds

# and this for UDP scanning
root@d3aaba212739:/# nmap -sU -p 53 google-dns  
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-21 14:10 UTC  
Nmap scan report for google-dns (8.8.8.8)  
Host is up (0.029s latency).  
  
PORT   STATE SERVICE  
53/udp open  domain  
  
Nmap done: 1 IP address (1 host up) scanned in 0.21 seconds  
```
We see that `google-dns` is reachable over both protocols.

- For $4.$, we need to look into `/etc/resolv.conf` and modify it such that we modify the `nameserver` to `8.8.8.8`. (make it point to Google's DNS instead of my local network's)
```bash
root@d3aaba212739:/# cat /etc/resolv.conf 
# Generated by Docker Engine.
# This file can be edited; Docker Engine will not make further changes once it
# has been modified.

nameserver 192.168.100.1

# Based on host file: '/etc/resolv.conf' (legacy)
# Overrides: []
root@d3aaba212739:/# echo "nameserver 8.8.8.8" > /etc/resolv.conf 
root@d3aaba212739:/# cat /etc/resolv.conf 
nameserver 8.8.8.8
root@d3aaba212739:/# dig cloudflare.com

; <<>> DiG 9.18.30-0ubuntu0.24.04.2-Ubuntu <<>> cloudflare.com
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 23389
;; flags: qr rd ra ad; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 512
;; QUESTION SECTION:
;cloudflare.com.                        IN      A

;; ANSWER SECTION:
cloudflare.com.         300     IN      A       104.16.133.229
cloudflare.com.         300     IN      A       104.16.132.229

;; Query time: 31 msec
;; SERVER: 8.8.8.8#53(8.8.8.8) (UDP)
;; WHEN: Fri Mar 21 14:25:47 UTC 2025
;; MSG SIZE  rcvd: 75
```![[Pasted image 20250321162721.png]]
```
We can see that the IP addresses we get back are the same. (Cloudflare uses its own DNS)

- For $5.$ we do `apt get-install nginx` and then we run the binary and check if the process is running with `grep` and `ps aux`:
```bash
root@d3aaba212739:/# nginx
root@d3aaba212739:/# ps aux | grep nginx
root        1022  0.0  0.0  11176  1596 ?        Ss   14:35   0:00 nginx: master process nginx
www-data    1023  0.0  0.0  11512  2788 ?        S    14:35   0:00 nginx: worker process
www-data    1024  0.0  0.0  11512  2788 ?        S    14:35   0:00 nginx: worker process
www-data    1025  0.0  0.0  11512  2676 ?        S    14:35   0:00 nginx: worker process
www-data    1026  0.0  0.0  11512  2660 ?        S    14:35   0:00 nginx: worker process
www-data    1027  0.0  0.0  11512  2676 ?        S    14:35   0:00 nginx: worker process
www-data    1028  0.0  0.0  11512  2788 ?        S    14:35   0:00 nginx: worker process
www-data    1029  0.0  0.0  11512  2788 ?        S    14:35   0:00 nginx: worker process
www-data    1030  0.0  0.0  11512  2676 ?        S    14:35   0:00 nginx: worker process
www-data    1031  0.0  0.0  11512  2676 ?        S    14:35   0:00 nginx: worker process
www-data    1032  0.0  0.0  11512  2660 ?        S    14:35   0:00 nginx: worker process
www-data    1033  0.0  0.0  11512  2788 ?        S    14:35   0:00 nginx: worker process
www-data    1034  0.0  0.0  11512  2620 ?        S    14:35   0:00 nginx: worker process
root        1036  0.0  0.0   3528  1792 pts/0    S+   14:35   0:00 grep --color=auto nginx
root@d3aaba212739:/# 
```

- For $6.$, we need to find the `nginx` process and find port associated to it:
```bash
root@d3aaba212739:/# ss -tulnp | grep nginx
tcp   LISTEN 0      511          0.0.0.0:80        0.0.0.0:*    users:(("nginx",pid=1022,fd=5))
tcp   LISTEN 0      511             [::]:80           [::]:*    users:(("nginx",pid=1022,fd=6))
```
And we see that it listens on port 80. `ss` shows network connections, ports, sockets and the flags help show TCP/UDP sockets, listening ones only, numeric ports and process owning socket.

## Bonus
- For $1^{st}$ bonus point, we need to modify the port in the `/etc/nginx/sites-enabled/default` file. Doing this with just `echo` would be difficult, we install `nano` with `apt install nano`
Then, we use the editor to make the change from:
```bash
        listen 80 default_server;
        listen [::]:80 default_server;
```
To:
```bash
        listen 8080 default_server;
        listen [::]:8080 default_server;
```

and we reload `nginx` and recheck with `ss` to confirm the change:
```bash
root@d3aaba212739:/# nginx -s reload
2025/03/21 14:51:26 [notice] 1096#1096: signal process started
root@d3aaba212739:/# ss -tulnp | grep nginx
tcp   LISTEN 0      511          0.0.0.0:8080      0.0.0.0:*    users:(("nginx",pid=1022,fd=33))
tcp   LISTEN 0      511             [::]:8080         [::]:*    users:(("nginx",pid=1022,fd=34))
```

- For $2^{nd}$ bonus point, I opened the config in `nano` (we could see the path mentioned in `/etc/nginx/sites-available/default`):
```bash
nano /var/www/html/index.nginx-debian.html
```
And just modified the text. We install `curl` with `apt install curl` and then `curl localhost:8080` to see if it worked:
```bash
root@d3aaba212739:/# curl localhost:8080
<!DOCTYPE html>
<html>
<head>
<title>Welcome to nginx!</title>
<style>
html { color-scheme: light dark; }
body { width: 35em; margin: 0 auto;
font-family: Tahoma, Verdana, Arial, sans-serif; }
</style>
</head>
<body>
<h1>I have completed the Linux part of the DevOps internship project</h1>
<p>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.</p>

<p>For online documentation and support please refer to
<a href="http://nginx.org/">nginx.org</a>.<br/>
Commercial support is available at
<a href="http://nginx.com/">nginx.com</a>.</p>

<p><em>Thank you for using nginx.</em></p>
</body>
</html>
```
